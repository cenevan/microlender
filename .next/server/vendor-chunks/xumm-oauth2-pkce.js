"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/xumm-oauth2-pkce";
exports.ids = ["vendor-chunks/xumm-oauth2-pkce"];
exports.modules = {

/***/ "(ssr)/./node_modules/xumm-oauth2-pkce/dist/index.js":
/*!*****************************************************!*\
  !*** ./node_modules/xumm-oauth2-pkce/dist/index.js ***!
  \*****************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {

eval("\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.XummPkce = exports.XummPkceThread = void 0;\n// import { debug as Debug } from \"debug\";\nconst events_1 = __webpack_require__(/*! events */ \"events\");\nconst xumm_sdk_1 = __webpack_require__(/*! xumm-sdk */ \"(ssr)/./node_modules/xumm-sdk/dist/src/index.js\");\nconst xumm_js_pkce_1 = __importDefault(__webpack_require__(/*! xumm-js-pkce */ \"(ssr)/./node_modules/xumm-js-pkce/dist/PKCE.js\"));\nconst log = function (...args) {\n    if (typeof localStorage !== \"undefined\") {\n        if (localStorage === null || localStorage === void 0 ? void 0 : localStorage.debug) {\n            console.log(...args);\n        }\n    }\n};\n// localStorage.debug = \"xummpkce*\";\n// Debug.log = log.bind(console);\n// const log = Debug(\"xummpkce\");\n// If everything else fails:\n// const log = (...args: any[]) => {\n//   alert(args.map((a) => JSON.stringify(a, null, 2)).join(\" \"));\n// };\nif (typeof window !== \"undefined\") {\n    log(\"Xumm OAuth2 PKCE Authorization Code Flow lib.\");\n}\nconst EventReadyPromise = (event) => {\n    let _resolve = (value) => { };\n    const promise = new Promise((resolve) => {\n        _resolve = resolve;\n    });\n    return {\n        promise,\n        resolve: (value) => {\n            // log(\"XummPKCE <Resolving eventReadyPromise>\", event);\n            return _resolve(value);\n        },\n    };\n};\nclass XummPkceThread extends events_1.EventEmitter {\n    constructor(xummApiKey, optionsOrRedirectUrl) {\n        var _a, _b;\n        super();\n        this.popup = null;\n        this.resolved = false;\n        this.mobileRedirectFlow = false;\n        this.eventPromises = {\n            retrieved: EventReadyPromise(\"retrieved\"),\n            error: EventReadyPromise(\"error\"),\n            success: EventReadyPromise(\"success\"),\n            loggedout: EventReadyPromise(\"loggedout\"),\n        };\n        this.options = {\n            redirectUrl: document.location.href,\n            rememberJwt: true,\n            storage: localStorage,\n            implicit: false,\n        };\n        /**\n         * Apply options\n         */\n        if (typeof optionsOrRedirectUrl === \"string\") {\n            this.options.redirectUrl = optionsOrRedirectUrl;\n        }\n        else if (typeof optionsOrRedirectUrl === \"object\" &&\n            optionsOrRedirectUrl) {\n            if (typeof optionsOrRedirectUrl.redirectUrl === \"string\") {\n                this.options.redirectUrl = optionsOrRedirectUrl.redirectUrl;\n            }\n            if (typeof optionsOrRedirectUrl.rememberJwt === \"boolean\") {\n                this.options.rememberJwt = optionsOrRedirectUrl.rememberJwt;\n            }\n            if (typeof optionsOrRedirectUrl.storage === \"object\") {\n                this.options.storage = optionsOrRedirectUrl.storage;\n            }\n            if (typeof optionsOrRedirectUrl.implicit === \"boolean\") {\n                this.options.implicit = optionsOrRedirectUrl.implicit;\n            }\n        }\n        /**\n         * Construct\n         */\n        const pkceOptions = {\n            client_id: xummApiKey,\n            redirect_uri: this.options.redirectUrl,\n            authorization_endpoint: \"https://oauth2.xumm.app/auth\",\n            token_endpoint: \"https://oauth2.xumm.app/token\",\n            requested_scopes: \"XummPkce\",\n            storage: this.options.storage,\n            implicit: this.options.implicit,\n        };\n        // log(JSON.stringify(pkceOptions, null, 2));\n        this.pkce = new xumm_js_pkce_1.default(pkceOptions);\n        /**\n         * Check if there is already a valid JWT to be used\n         */\n        if (this.options.rememberJwt) {\n            log(\"Remember JWT\");\n            try {\n                const existingJwt = JSON.parse(((_a = this.options.storage) === null || _a === void 0 ? void 0 : _a.getItem(\"XummPkceJwt\")) || \"{}\");\n                if ((existingJwt === null || existingJwt === void 0 ? void 0 : existingJwt.jwt) && typeof existingJwt.jwt === \"string\") {\n                    const sdk = new xumm_sdk_1.XummSdkJwt(existingJwt.jwt);\n                    this.ping = sdk.ping();\n                    this.ping\n                        .then((pong) => __awaiter(this, void 0, void 0, function* () {\n                        var _c;\n                        /**\n                         * Pretend mobile so no window.open is triggered\n                         */\n                        if ((_c = pong === null || pong === void 0 ? void 0 : pong.jwtData) === null || _c === void 0 ? void 0 : _c.sub) {\n                            // Yay, user still signed in, JWT still valid!\n                            this.autoResolvedFlow = Object.assign(existingJwt, { sdk });\n                            yield this.authorize();\n                            this.emit(\"retrieved\");\n                        }\n                        else {\n                            this.logout();\n                        }\n                    }))\n                        .catch((e) => {\n                        // That didn't work\n                        this.logout();\n                    });\n                }\n                else {\n                    this.logout();\n                }\n            }\n            catch (e) {\n                // Do nothing\n            }\n        }\n        window.addEventListener(\"message\", (event) => {\n            var _a;\n            log(\"Received Event from \", event.origin);\n            if (String((event === null || event === void 0 ? void 0 : event.data) || \"\").slice(0, 1) === \"{\" &&\n                String((event === null || event === void 0 ? void 0 : event.data) || \"\").slice(-1) === \"}\") {\n                log(\"Got PostMessage with JSON\");\n                if (event.origin === \"https://xumm.app\" ||\n                    event.origin === \"https://oauth2.xumm.app\") {\n                    log(\"Got PostMessage from https://xumm.app / https://oauth2.xumm.app\");\n                    try {\n                        const postMessage = JSON.parse(event.data);\n                        if ((postMessage === null || postMessage === void 0 ? void 0 : postMessage.source) === \"xumm_sign_request\" &&\n                            (postMessage === null || postMessage === void 0 ? void 0 : postMessage.payload)) {\n                            log(\"Payload opened:\", postMessage.payload);\n                        }\n                        else if ((postMessage === null || postMessage === void 0 ? void 0 : postMessage.source) === \"xumm_sign_request_resolved\" &&\n                            (postMessage === null || postMessage === void 0 ? void 0 : postMessage.options)) {\n                            // log(\"Payload resolved:\", postMessage.options);\n                            log(\"Payload resolved, mostmessage containing options containing redirect URL: \", postMessage);\n                            /**\n                             * Beat the 750ms timing for the window close as the exchange\n                             * may still take a whil (async HTTP call). We don't know YET\n                             * if we resolved successfully but we sure did resolve.\n                             */\n                            this.resolved = true;\n                            this.pkce\n                                .exchangeForAccessToken(postMessage.options.full_redirect_uri)\n                                .then((resp) => {\n                                this.jwt = resp.access_token;\n                                if (resp === null || resp === void 0 ? void 0 : resp.error_description) {\n                                    throw new Error(resp === null || resp === void 0 ? void 0 : resp.error_description);\n                                }\n                                // if (this.resolvePromise) {\n                                //   this.resolvePromise({\n                                //     jwt: this.jwt,\n                                //     sdk: new XummSdkJwt(this.jwt),\n                                //   });\n                                // }\n                                fetch(\"https://oauth2.xumm.app/userinfo\", {\n                                    headers: {\n                                        Authorization: \"Bearer \" + resp.access_token,\n                                    },\n                                })\n                                    .then((r) => r.json())\n                                    .then((me) => {\n                                    var _a;\n                                    if (this.resolvePromise) {\n                                        if (this.options.rememberJwt) {\n                                            log(\"Remembering JWT\");\n                                            try {\n                                                (_a = this.options.storage) === null || _a === void 0 ? void 0 : _a.setItem(\"XummPkceJwt\", JSON.stringify({ jwt: resp.access_token, me }));\n                                            }\n                                            catch (e) {\n                                                log(\"Could not persist JWT to local storage\", e);\n                                            }\n                                        }\n                                        this.resolvePromise({\n                                            jwt: resp.access_token,\n                                            sdk: new xumm_sdk_1.XummSdkJwt(resp.access_token),\n                                            me,\n                                        });\n                                    }\n                                });\n                                // Do stuff with the access token.\n                            })\n                                .catch((e) => {\n                                if (this.rejectPromise) {\n                                    this.rejectPromise((e === null || e === void 0 ? void 0 : e.error) ? new Error(e.error) : e);\n                                }\n                                log((e === null || e === void 0 ? void 0 : e.error) || e);\n                            });\n                        }\n                        else if ((postMessage === null || postMessage === void 0 ? void 0 : postMessage.source) === \"xumm_sign_request_rejected\") {\n                            log(\"Payload rejected\", postMessage === null || postMessage === void 0 ? void 0 : postMessage.options);\n                            if (this.rejectPromise) {\n                                this.rejectPromise(new Error(((_a = postMessage === null || postMessage === void 0 ? void 0 : postMessage.options) === null || _a === void 0 ? void 0 : _a.error_description) ||\n                                    \"Payload rejected\"));\n                            }\n                        }\n                        else if ((postMessage === null || postMessage === void 0 ? void 0 : postMessage.source) === \"xumm_sign_request_popup_closed\") {\n                            log(\"Popup closed, wait 750ms\");\n                            // Wait, maybe the real reason comes in later (e.g. explicitly rejected)\n                            setTimeout(() => {\n                                if (!this.resolved && this.rejectPromise) {\n                                    this.rejectPromise(new Error(\"Sign In window closed\"));\n                                }\n                            }, 750);\n                        }\n                        else {\n                            log(\"Unexpected message, skipping\", postMessage === null || postMessage === void 0 ? void 0 : postMessage.source);\n                        }\n                    }\n                    catch (e) {\n                        log(\"Error parsing message\", (e === null || e === void 0 ? void 0 : e.message) || e);\n                    }\n                }\n            }\n        }, false);\n        const params = new URLSearchParams(((_b = document === null || document === void 0 ? void 0 : document.location) === null || _b === void 0 ? void 0 : _b.search) || \"\");\n        if (params.get(\"authorization_code\") ||\n            params.get(\"access_token\") ||\n            params.get(\"error_description\")) {\n            this.mobileRedirectFlow = true;\n            this.urlParams = params;\n            let documentReadyExecuted = false;\n            const onDocumentReady = (event) => __awaiter(this, void 0, void 0, function* () {\n                log(\"onDocumentReady\", document.readyState);\n                if (!documentReadyExecuted && document.readyState === \"complete\") {\n                    documentReadyExecuted = true;\n                    log(\"(readystatechange: [ \" + document.readyState + \" ])\");\n                    this.handleMobileGrant();\n                    yield this.authorize();\n                    this.emit(\"retrieved\");\n                }\n            });\n            onDocumentReady();\n            document.addEventListener(\"readystatechange\", onDocumentReady);\n        }\n    }\n    emit(event, ...args) {\n        // log(\"emitting event\", event, ...args);\n        // log(\"subscribers for event\", event, this.listenerCount(event));\n        this.eventPromises[event].promise.then(() => {\n            // Emit when subscribed\n            return super.emit(event, ...args);\n        });\n        return true;\n    }\n    on(event, listener) {\n        // log(\"event added, on\", event);\n        this.eventPromises[event].resolve();\n        return super.on(event, listener);\n    }\n    off(event, listener) {\n        // log(\"event removed, off\", event);\n        // Reset promise\n        this.eventPromises[event] = EventReadyPromise(event);\n        return super.off(event, listener);\n    }\n    // Todo: document, e.g. custom flow, plugin\n    authorizeUrl() {\n        return this.pkce.authorizeUrl();\n    }\n    handleMobileGrant() {\n        if (this.urlParams && this.mobileRedirectFlow) {\n            // log(\"Send message event\");\n            const messageEventData = {\n                data: JSON.stringify(this.urlParams.get(\"authorization_code\") ||\n                    this.urlParams.get(\"access_token\")\n                    ? {\n                        source: \"xumm_sign_request_resolved\",\n                        options: {\n                            full_redirect_uri: document.location.href,\n                        },\n                    }\n                    : {\n                        source: \"xumm_sign_request_rejected\",\n                        options: {\n                            error: this.urlParams.get(\"error\"),\n                            error_code: this.urlParams.get(\"error_code\"),\n                            error_description: this.urlParams.get(\"error_description\"),\n                        },\n                    }),\n                origin: \"https://oauth2.xumm.app\",\n            };\n            const event = new MessageEvent(\"message\", messageEventData);\n            window.dispatchEvent(event);\n            return true;\n        }\n        return false;\n    }\n    authorize() {\n        return __awaiter(this, void 0, void 0, function* () {\n            // Do not authorize twice\n            if (this.resolvedSuccessfully) {\n                return this.promise;\n            }\n            this.resolved = false;\n            try {\n                yield this.ping;\n            }\n            catch (e) {\n                // Nope (prevent 401 error from API to bleed into auth flow)\n            }\n            if (!this.mobileRedirectFlow && !this.autoResolvedFlow) {\n                const url = this.authorizeUrl();\n                const popup = window.open(url, \"XummPkceLogin\", \"directories=no,titlebar=no,toolbar=no,location=no,status=no,\" +\n                    \"menubar=no,scrollbars=no,resizable=no,width=600,height=790\");\n                this.popup = popup;\n                log(\"Popup opened...\", url);\n            }\n            this.resolved = false;\n            const clearUrlParams = () => {\n                var _a;\n                const newUrlParams = new URLSearchParams(((_a = document === null || document === void 0 ? void 0 : document.location) === null || _a === void 0 ? void 0 : _a.search) || \"\");\n                // PKCE\n                newUrlParams.delete(\"authorization_code\");\n                newUrlParams.delete(\"code\");\n                newUrlParams.delete(\"scope\");\n                newUrlParams.delete(\"state\");\n                // Implicit\n                newUrlParams.delete(\"access_token\");\n                newUrlParams.delete(\"refresh_token\");\n                newUrlParams.delete(\"token_type\");\n                newUrlParams.delete(\"expires_in\");\n                const newSearchParamsString = newUrlParams.toString();\n                const url = document.location.href.split(\"?\")[0] +\n                    (newSearchParamsString !== \"\" ? \"?\" : \"\") +\n                    newSearchParamsString;\n                window.history.replaceState({ path: url }, \"\", url);\n            };\n            clearUrlParams();\n            if (this.autoResolvedFlow) {\n                if (!this.resolved) {\n                    this.resolved = true;\n                    this.promise = Promise.resolve(this.autoResolvedFlow);\n                    this.rejectPromise = this.resolvePromise = () => { };\n                    log(\"Auto resolved\");\n                    this.emit(\"success\");\n                }\n            }\n            else {\n                this.promise = new Promise((resolve, reject) => {\n                    this.resolvePromise = (_) => {\n                        const resolved = resolve(_);\n                        this.resolved = true;\n                        this.resolvedSuccessfully = true;\n                        log(\"Xumm Sign in RESOLVED\");\n                        this.emit(\"success\");\n                        return resolved;\n                    };\n                    this.rejectPromise = (_) => {\n                        const rejected = reject(_);\n                        this.resolved = true;\n                        this.emit(\"error\", typeof _ === \"string\" ? new Error(_) : _);\n                        log(\"Xumm Sign in REJECTED\");\n                        return rejected;\n                    };\n                });\n            }\n            return this.promise;\n        });\n    }\n    state() {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.promise;\n        });\n    }\n    logout() {\n        var _a;\n        // log(\"PKCE Logout\");\n        setTimeout(() => this.emit(\"loggedout\"), 0);\n        try {\n            this.resolved = false;\n            this.resolvedSuccessfully = undefined;\n            this.autoResolvedFlow = undefined;\n            (_a = this.options.storage) === null || _a === void 0 ? void 0 : _a.removeItem(\"XummPkceJwt\");\n            this.mobileRedirectFlow = false;\n        }\n        catch (e) {\n            // Nothing to do\n        }\n        return;\n    }\n    getPopup() {\n        return this === null || this === void 0 ? void 0 : this.popup;\n    }\n}\nexports.XummPkceThread = XummPkceThread;\nconst thread = (_XummPkce) => {\n    let attached = false;\n    if (_XummPkce) {\n        if (typeof window === \"object\") {\n            if (typeof window._XummPkce === \"undefined\") {\n                window._XummPkce = _XummPkce;\n                attached = true;\n            }\n        }\n    }\n    const instance = window === null || window === void 0 ? void 0 : window._XummPkce;\n    if (instance && attached) {\n        log(\"XummPkce attached to window\");\n    }\n    return instance;\n};\nclass XummPkce {\n    constructor(xummApiKey, optionsOrRedirectUrl) {\n        if (typeof window === \"undefined\" || typeof document === \"undefined\") {\n            return;\n        }\n        if (!thread()) {\n            thread(new XummPkceThread(xummApiKey, optionsOrRedirectUrl));\n        }\n    }\n    on(event, listener) {\n        const t = thread();\n        if (!t) {\n            return;\n        }\n        t.on(event, listener);\n        return this;\n    }\n    off(event, listener) {\n        const t = thread();\n        if (!t) {\n            return;\n        }\n        t.off(event, listener);\n        return this;\n    }\n    authorize() {\n        const t = thread();\n        if (!t) {\n            return;\n        }\n        return t.authorize();\n    }\n    state() {\n        const t = thread();\n        if (!t) {\n            return;\n        }\n        return t.state();\n    }\n    logout() {\n        const t = thread();\n        if (!t) {\n            return;\n        }\n        return t.logout();\n    }\n}\nexports.XummPkce = XummPkce;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMveHVtbS1vYXV0aDItcGtjZS9kaXN0L2luZGV4LmpzIiwibWFwcGluZ3MiOiJBQUFhO0FBQ2I7QUFDQSw0QkFBNEIsK0RBQStELGlCQUFpQjtBQUM1RztBQUNBLG9DQUFvQyxNQUFNLCtCQUErQixZQUFZO0FBQ3JGLG1DQUFtQyxNQUFNLG1DQUFtQyxZQUFZO0FBQ3hGLGdDQUFnQztBQUNoQztBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsNkNBQTZDO0FBQzdDO0FBQ0EsOENBQTZDLEVBQUUsYUFBYSxFQUFDO0FBQzdELGdCQUFnQixHQUFHLHNCQUFzQjtBQUN6QyxZQUFZLGlCQUFpQjtBQUM3QixpQkFBaUIsbUJBQU8sQ0FBQyxzQkFBUTtBQUNqQyxtQkFBbUIsbUJBQU8sQ0FBQyxpRUFBVTtBQUNyQyx1Q0FBdUMsbUJBQU8sQ0FBQyxvRUFBYztBQUM3RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0pBQWtKO0FBQ2xKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpRkFBaUYsS0FBSztBQUN0RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJHQUEyRztBQUMzRyx5R0FBeUc7QUFDekc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0M7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUM7QUFDckMsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEpBQTRKLDRCQUE0QjtBQUN4TDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5Q0FBeUM7QUFDekM7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhDQUE4QyxXQUFXO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQiIsInNvdXJjZXMiOlsid2VicGFjazovL21pY3JvbGVuZGVyLy4vbm9kZV9tb2R1bGVzL3h1bW0tb2F1dGgyLXBrY2UvZGlzdC9pbmRleC5qcz8xYTllIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlh1bW1Qa2NlID0gZXhwb3J0cy5YdW1tUGtjZVRocmVhZCA9IHZvaWQgMDtcbi8vIGltcG9ydCB7IGRlYnVnIGFzIERlYnVnIH0gZnJvbSBcImRlYnVnXCI7XG5jb25zdCBldmVudHNfMSA9IHJlcXVpcmUoXCJldmVudHNcIik7XG5jb25zdCB4dW1tX3Nka18xID0gcmVxdWlyZShcInh1bW0tc2RrXCIpO1xuY29uc3QgeHVtbV9qc19wa2NlXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcInh1bW0tanMtcGtjZVwiKSk7XG5jb25zdCBsb2cgPSBmdW5jdGlvbiAoLi4uYXJncykge1xuICAgIGlmICh0eXBlb2YgbG9jYWxTdG9yYWdlICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgIGlmIChsb2NhbFN0b3JhZ2UgPT09IG51bGwgfHwgbG9jYWxTdG9yYWdlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBsb2NhbFN0b3JhZ2UuZGVidWcpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKC4uLmFyZ3MpO1xuICAgICAgICB9XG4gICAgfVxufTtcbi8vIGxvY2FsU3RvcmFnZS5kZWJ1ZyA9IFwieHVtbXBrY2UqXCI7XG4vLyBEZWJ1Zy5sb2cgPSBsb2cuYmluZChjb25zb2xlKTtcbi8vIGNvbnN0IGxvZyA9IERlYnVnKFwieHVtbXBrY2VcIik7XG4vLyBJZiBldmVyeXRoaW5nIGVsc2UgZmFpbHM6XG4vLyBjb25zdCBsb2cgPSAoLi4uYXJnczogYW55W10pID0+IHtcbi8vICAgYWxlcnQoYXJncy5tYXAoKGEpID0+IEpTT04uc3RyaW5naWZ5KGEsIG51bGwsIDIpKS5qb2luKFwiIFwiKSk7XG4vLyB9O1xuaWYgKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICBsb2coXCJYdW1tIE9BdXRoMiBQS0NFIEF1dGhvcml6YXRpb24gQ29kZSBGbG93IGxpYi5cIik7XG59XG5jb25zdCBFdmVudFJlYWR5UHJvbWlzZSA9IChldmVudCkgPT4ge1xuICAgIGxldCBfcmVzb2x2ZSA9ICh2YWx1ZSkgPT4geyB9O1xuICAgIGNvbnN0IHByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgICBfcmVzb2x2ZSA9IHJlc29sdmU7XG4gICAgfSk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcHJvbWlzZSxcbiAgICAgICAgcmVzb2x2ZTogKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAvLyBsb2coXCJYdW1tUEtDRSA8UmVzb2x2aW5nIGV2ZW50UmVhZHlQcm9taXNlPlwiLCBldmVudCk7XG4gICAgICAgICAgICByZXR1cm4gX3Jlc29sdmUodmFsdWUpO1xuICAgICAgICB9LFxuICAgIH07XG59O1xuY2xhc3MgWHVtbVBrY2VUaHJlYWQgZXh0ZW5kcyBldmVudHNfMS5FdmVudEVtaXR0ZXIge1xuICAgIGNvbnN0cnVjdG9yKHh1bW1BcGlLZXksIG9wdGlvbnNPclJlZGlyZWN0VXJsKSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMucG9wdXAgPSBudWxsO1xuICAgICAgICB0aGlzLnJlc29sdmVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMubW9iaWxlUmVkaXJlY3RGbG93ID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZXZlbnRQcm9taXNlcyA9IHtcbiAgICAgICAgICAgIHJldHJpZXZlZDogRXZlbnRSZWFkeVByb21pc2UoXCJyZXRyaWV2ZWRcIiksXG4gICAgICAgICAgICBlcnJvcjogRXZlbnRSZWFkeVByb21pc2UoXCJlcnJvclwiKSxcbiAgICAgICAgICAgIHN1Y2Nlc3M6IEV2ZW50UmVhZHlQcm9taXNlKFwic3VjY2Vzc1wiKSxcbiAgICAgICAgICAgIGxvZ2dlZG91dDogRXZlbnRSZWFkeVByb21pc2UoXCJsb2dnZWRvdXRcIiksXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHJlZGlyZWN0VXJsOiBkb2N1bWVudC5sb2NhdGlvbi5ocmVmLFxuICAgICAgICAgICAgcmVtZW1iZXJKd3Q6IHRydWUsXG4gICAgICAgICAgICBzdG9yYWdlOiBsb2NhbFN0b3JhZ2UsXG4gICAgICAgICAgICBpbXBsaWNpdDogZmFsc2UsXG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBcHBseSBvcHRpb25zXG4gICAgICAgICAqL1xuICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnNPclJlZGlyZWN0VXJsID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMucmVkaXJlY3RVcmwgPSBvcHRpb25zT3JSZWRpcmVjdFVybDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0eXBlb2Ygb3B0aW9uc09yUmVkaXJlY3RVcmwgPT09IFwib2JqZWN0XCIgJiZcbiAgICAgICAgICAgIG9wdGlvbnNPclJlZGlyZWN0VXJsKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnNPclJlZGlyZWN0VXJsLnJlZGlyZWN0VXJsID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLnJlZGlyZWN0VXJsID0gb3B0aW9uc09yUmVkaXJlY3RVcmwucmVkaXJlY3RVcmw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnNPclJlZGlyZWN0VXJsLnJlbWVtYmVySnd0ID09PSBcImJvb2xlYW5cIikge1xuICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5yZW1lbWJlckp3dCA9IG9wdGlvbnNPclJlZGlyZWN0VXJsLnJlbWVtYmVySnd0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zT3JSZWRpcmVjdFVybC5zdG9yYWdlID09PSBcIm9iamVjdFwiKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLnN0b3JhZ2UgPSBvcHRpb25zT3JSZWRpcmVjdFVybC5zdG9yYWdlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zT3JSZWRpcmVjdFVybC5pbXBsaWNpdCA9PT0gXCJib29sZWFuXCIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuaW1wbGljaXQgPSBvcHRpb25zT3JSZWRpcmVjdFVybC5pbXBsaWNpdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICogQ29uc3RydWN0XG4gICAgICAgICAqL1xuICAgICAgICBjb25zdCBwa2NlT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIGNsaWVudF9pZDogeHVtbUFwaUtleSxcbiAgICAgICAgICAgIHJlZGlyZWN0X3VyaTogdGhpcy5vcHRpb25zLnJlZGlyZWN0VXJsLFxuICAgICAgICAgICAgYXV0aG9yaXphdGlvbl9lbmRwb2ludDogXCJodHRwczovL29hdXRoMi54dW1tLmFwcC9hdXRoXCIsXG4gICAgICAgICAgICB0b2tlbl9lbmRwb2ludDogXCJodHRwczovL29hdXRoMi54dW1tLmFwcC90b2tlblwiLFxuICAgICAgICAgICAgcmVxdWVzdGVkX3Njb3BlczogXCJYdW1tUGtjZVwiLFxuICAgICAgICAgICAgc3RvcmFnZTogdGhpcy5vcHRpb25zLnN0b3JhZ2UsXG4gICAgICAgICAgICBpbXBsaWNpdDogdGhpcy5vcHRpb25zLmltcGxpY2l0LFxuICAgICAgICB9O1xuICAgICAgICAvLyBsb2coSlNPTi5zdHJpbmdpZnkocGtjZU9wdGlvbnMsIG51bGwsIDIpKTtcbiAgICAgICAgdGhpcy5wa2NlID0gbmV3IHh1bW1fanNfcGtjZV8xLmRlZmF1bHQocGtjZU9wdGlvbnMpO1xuICAgICAgICAvKipcbiAgICAgICAgICogQ2hlY2sgaWYgdGhlcmUgaXMgYWxyZWFkeSBhIHZhbGlkIEpXVCB0byBiZSB1c2VkXG4gICAgICAgICAqL1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLnJlbWVtYmVySnd0KSB7XG4gICAgICAgICAgICBsb2coXCJSZW1lbWJlciBKV1RcIik7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nSnd0ID0gSlNPTi5wYXJzZSgoKF9hID0gdGhpcy5vcHRpb25zLnN0b3JhZ2UpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5nZXRJdGVtKFwiWHVtbVBrY2VKd3RcIikpIHx8IFwie31cIik7XG4gICAgICAgICAgICAgICAgaWYgKChleGlzdGluZ0p3dCA9PT0gbnVsbCB8fCBleGlzdGluZ0p3dCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXhpc3RpbmdKd3Quand0KSAmJiB0eXBlb2YgZXhpc3RpbmdKd3Quand0ID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNkayA9IG5ldyB4dW1tX3Nka18xLlh1bW1TZGtKd3QoZXhpc3RpbmdKd3Quand0KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5waW5nID0gc2RrLnBpbmcoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5waW5nXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbigocG9uZykgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9jO1xuICAgICAgICAgICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICAgICAgICAgKiBQcmV0ZW5kIG1vYmlsZSBzbyBubyB3aW5kb3cub3BlbiBpcyB0cmlnZ2VyZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChfYyA9IHBvbmcgPT09IG51bGwgfHwgcG9uZyA9PT0gdm9pZCAwID8gdm9pZCAwIDogcG9uZy5qd3REYXRhKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Muc3ViKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gWWF5LCB1c2VyIHN0aWxsIHNpZ25lZCBpbiwgSldUIHN0aWxsIHZhbGlkIVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXV0b1Jlc29sdmVkRmxvdyA9IE9iamVjdC5hc3NpZ24oZXhpc3RpbmdKd3QsIHsgc2RrIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHlpZWxkIHRoaXMuYXV0aG9yaXplKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KFwicmV0cmlldmVkXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dvdXQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSkpXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoYXQgZGlkbid0IHdvcmtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nb3V0KCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dvdXQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIC8vIERvIG5vdGhpbmdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICBsb2coXCJSZWNlaXZlZCBFdmVudCBmcm9tIFwiLCBldmVudC5vcmlnaW4pO1xuICAgICAgICAgICAgaWYgKFN0cmluZygoZXZlbnQgPT09IG51bGwgfHwgZXZlbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGV2ZW50LmRhdGEpIHx8IFwiXCIpLnNsaWNlKDAsIDEpID09PSBcIntcIiAmJlxuICAgICAgICAgICAgICAgIFN0cmluZygoZXZlbnQgPT09IG51bGwgfHwgZXZlbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGV2ZW50LmRhdGEpIHx8IFwiXCIpLnNsaWNlKC0xKSA9PT0gXCJ9XCIpIHtcbiAgICAgICAgICAgICAgICBsb2coXCJHb3QgUG9zdE1lc3NhZ2Ugd2l0aCBKU09OXCIpO1xuICAgICAgICAgICAgICAgIGlmIChldmVudC5vcmlnaW4gPT09IFwiaHR0cHM6Ly94dW1tLmFwcFwiIHx8XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50Lm9yaWdpbiA9PT0gXCJodHRwczovL29hdXRoMi54dW1tLmFwcFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGxvZyhcIkdvdCBQb3N0TWVzc2FnZSBmcm9tIGh0dHBzOi8veHVtbS5hcHAgLyBodHRwczovL29hdXRoMi54dW1tLmFwcFwiKTtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBvc3RNZXNzYWdlID0gSlNPTi5wYXJzZShldmVudC5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgocG9zdE1lc3NhZ2UgPT09IG51bGwgfHwgcG9zdE1lc3NhZ2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvc3RNZXNzYWdlLnNvdXJjZSkgPT09IFwieHVtbV9zaWduX3JlcXVlc3RcIiAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChwb3N0TWVzc2FnZSA9PT0gbnVsbCB8fCBwb3N0TWVzc2FnZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcG9zdE1lc3NhZ2UucGF5bG9hZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2coXCJQYXlsb2FkIG9wZW5lZDpcIiwgcG9zdE1lc3NhZ2UucGF5bG9hZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICgocG9zdE1lc3NhZ2UgPT09IG51bGwgfHwgcG9zdE1lc3NhZ2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvc3RNZXNzYWdlLnNvdXJjZSkgPT09IFwieHVtbV9zaWduX3JlcXVlc3RfcmVzb2x2ZWRcIiAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChwb3N0TWVzc2FnZSA9PT0gbnVsbCB8fCBwb3N0TWVzc2FnZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcG9zdE1lc3NhZ2Uub3B0aW9ucykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBsb2coXCJQYXlsb2FkIHJlc29sdmVkOlwiLCBwb3N0TWVzc2FnZS5vcHRpb25zKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2coXCJQYXlsb2FkIHJlc29sdmVkLCBtb3N0bWVzc2FnZSBjb250YWluaW5nIG9wdGlvbnMgY29udGFpbmluZyByZWRpcmVjdCBVUkw6IFwiLCBwb3N0TWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICogQmVhdCB0aGUgNzUwbXMgdGltaW5nIGZvciB0aGUgd2luZG93IGNsb3NlIGFzIHRoZSBleGNoYW5nZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIG1heSBzdGlsbCB0YWtlIGEgd2hpbCAoYXN5bmMgSFRUUCBjYWxsKS4gV2UgZG9uJ3Qga25vdyBZRVRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBpZiB3ZSByZXNvbHZlZCBzdWNjZXNzZnVsbHkgYnV0IHdlIHN1cmUgZGlkIHJlc29sdmUuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNvbHZlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wa2NlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5leGNoYW5nZUZvckFjY2Vzc1Rva2VuKHBvc3RNZXNzYWdlLm9wdGlvbnMuZnVsbF9yZWRpcmVjdF91cmkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXNwKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuand0ID0gcmVzcC5hY2Nlc3NfdG9rZW47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwID09PSBudWxsIHx8IHJlc3AgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlc3AuZXJyb3JfZGVzY3JpcHRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihyZXNwID09PSBudWxsIHx8IHJlc3AgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlc3AuZXJyb3JfZGVzY3JpcHRpb24pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmICh0aGlzLnJlc29sdmVQcm9taXNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgdGhpcy5yZXNvbHZlUHJvbWlzZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICBqd3Q6IHRoaXMuand0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgc2RrOiBuZXcgWHVtbVNka0p3dCh0aGlzLmp3dCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2goXCJodHRwczovL29hdXRoMi54dW1tLmFwcC91c2VyaW5mb1wiLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogXCJCZWFyZXIgXCIgKyByZXNwLmFjY2Vzc190b2tlbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbigocikgPT4gci5qc29uKCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbigobWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlc29sdmVQcm9taXNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5yZW1lbWJlckp3dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2coXCJSZW1lbWJlcmluZyBKV1RcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoX2EgPSB0aGlzLm9wdGlvbnMuc3RvcmFnZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNldEl0ZW0oXCJYdW1tUGtjZUp3dFwiLCBKU09OLnN0cmluZ2lmeSh7IGp3dDogcmVzcC5hY2Nlc3NfdG9rZW4sIG1lIH0pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nKFwiQ291bGQgbm90IHBlcnNpc3QgSldUIHRvIGxvY2FsIHN0b3JhZ2VcIiwgZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNvbHZlUHJvbWlzZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGp3dDogcmVzcC5hY2Nlc3NfdG9rZW4sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNkazogbmV3IHh1bW1fc2RrXzEuWHVtbVNka0p3dChyZXNwLmFjY2Vzc190b2tlbiksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRG8gc3R1ZmYgd2l0aCB0aGUgYWNjZXNzIHRva2VuLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaCgoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5yZWplY3RQcm9taXNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlamVjdFByb21pc2UoKGUgPT09IG51bGwgfHwgZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZS5lcnJvcikgPyBuZXcgRXJyb3IoZS5lcnJvcikgOiBlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2coKGUgPT09IG51bGwgfHwgZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZS5lcnJvcikgfHwgZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICgocG9zdE1lc3NhZ2UgPT09IG51bGwgfHwgcG9zdE1lc3NhZ2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvc3RNZXNzYWdlLnNvdXJjZSkgPT09IFwieHVtbV9zaWduX3JlcXVlc3RfcmVqZWN0ZWRcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhcIlBheWxvYWQgcmVqZWN0ZWRcIiwgcG9zdE1lc3NhZ2UgPT09IG51bGwgfHwgcG9zdE1lc3NhZ2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvc3RNZXNzYWdlLm9wdGlvbnMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlamVjdFByb21pc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWplY3RQcm9taXNlKG5ldyBFcnJvcigoKF9hID0gcG9zdE1lc3NhZ2UgPT09IG51bGwgfHwgcG9zdE1lc3NhZ2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvc3RNZXNzYWdlLm9wdGlvbnMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5lcnJvcl9kZXNjcmlwdGlvbikgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiUGF5bG9hZCByZWplY3RlZFwiKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoKHBvc3RNZXNzYWdlID09PSBudWxsIHx8IHBvc3RNZXNzYWdlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwb3N0TWVzc2FnZS5zb3VyY2UpID09PSBcInh1bW1fc2lnbl9yZXF1ZXN0X3BvcHVwX2Nsb3NlZFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nKFwiUG9wdXAgY2xvc2VkLCB3YWl0IDc1MG1zXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdhaXQsIG1heWJlIHRoZSByZWFsIHJlYXNvbiBjb21lcyBpbiBsYXRlciAoZS5nLiBleHBsaWNpdGx5IHJlamVjdGVkKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMucmVzb2x2ZWQgJiYgdGhpcy5yZWplY3RQcm9taXNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlamVjdFByb21pc2UobmV3IEVycm9yKFwiU2lnbiBJbiB3aW5kb3cgY2xvc2VkXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDc1MCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2coXCJVbmV4cGVjdGVkIG1lc3NhZ2UsIHNraXBwaW5nXCIsIHBvc3RNZXNzYWdlID09PSBudWxsIHx8IHBvc3RNZXNzYWdlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwb3N0TWVzc2FnZS5zb3VyY2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2coXCJFcnJvciBwYXJzaW5nIG1lc3NhZ2VcIiwgKGUgPT09IG51bGwgfHwgZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZS5tZXNzYWdlKSB8fCBlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgZmFsc2UpO1xuICAgICAgICBjb25zdCBwYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCgoX2IgPSBkb2N1bWVudCA9PT0gbnVsbCB8fCBkb2N1bWVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZG9jdW1lbnQubG9jYXRpb24pID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5zZWFyY2gpIHx8IFwiXCIpO1xuICAgICAgICBpZiAocGFyYW1zLmdldChcImF1dGhvcml6YXRpb25fY29kZVwiKSB8fFxuICAgICAgICAgICAgcGFyYW1zLmdldChcImFjY2Vzc190b2tlblwiKSB8fFxuICAgICAgICAgICAgcGFyYW1zLmdldChcImVycm9yX2Rlc2NyaXB0aW9uXCIpKSB7XG4gICAgICAgICAgICB0aGlzLm1vYmlsZVJlZGlyZWN0RmxvdyA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLnVybFBhcmFtcyA9IHBhcmFtcztcbiAgICAgICAgICAgIGxldCBkb2N1bWVudFJlYWR5RXhlY3V0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIGNvbnN0IG9uRG9jdW1lbnRSZWFkeSA9IChldmVudCkgPT4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgICAgIGxvZyhcIm9uRG9jdW1lbnRSZWFkeVwiLCBkb2N1bWVudC5yZWFkeVN0YXRlKTtcbiAgICAgICAgICAgICAgICBpZiAoIWRvY3VtZW50UmVhZHlFeGVjdXRlZCAmJiBkb2N1bWVudC5yZWFkeVN0YXRlID09PSBcImNvbXBsZXRlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnRSZWFkeUV4ZWN1dGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgbG9nKFwiKHJlYWR5c3RhdGVjaGFuZ2U6IFsgXCIgKyBkb2N1bWVudC5yZWFkeVN0YXRlICsgXCIgXSlcIik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlTW9iaWxlR3JhbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgeWllbGQgdGhpcy5hdXRob3JpemUoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KFwicmV0cmlldmVkXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgb25Eb2N1bWVudFJlYWR5KCk7XG4gICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwicmVhZHlzdGF0ZWNoYW5nZVwiLCBvbkRvY3VtZW50UmVhZHkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVtaXQoZXZlbnQsIC4uLmFyZ3MpIHtcbiAgICAgICAgLy8gbG9nKFwiZW1pdHRpbmcgZXZlbnRcIiwgZXZlbnQsIC4uLmFyZ3MpO1xuICAgICAgICAvLyBsb2coXCJzdWJzY3JpYmVycyBmb3IgZXZlbnRcIiwgZXZlbnQsIHRoaXMubGlzdGVuZXJDb3VudChldmVudCkpO1xuICAgICAgICB0aGlzLmV2ZW50UHJvbWlzZXNbZXZlbnRdLnByb21pc2UudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAvLyBFbWl0IHdoZW4gc3Vic2NyaWJlZFxuICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmVtaXQoZXZlbnQsIC4uLmFyZ3MpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIG9uKGV2ZW50LCBsaXN0ZW5lcikge1xuICAgICAgICAvLyBsb2coXCJldmVudCBhZGRlZCwgb25cIiwgZXZlbnQpO1xuICAgICAgICB0aGlzLmV2ZW50UHJvbWlzZXNbZXZlbnRdLnJlc29sdmUoKTtcbiAgICAgICAgcmV0dXJuIHN1cGVyLm9uKGV2ZW50LCBsaXN0ZW5lcik7XG4gICAgfVxuICAgIG9mZihldmVudCwgbGlzdGVuZXIpIHtcbiAgICAgICAgLy8gbG9nKFwiZXZlbnQgcmVtb3ZlZCwgb2ZmXCIsIGV2ZW50KTtcbiAgICAgICAgLy8gUmVzZXQgcHJvbWlzZVxuICAgICAgICB0aGlzLmV2ZW50UHJvbWlzZXNbZXZlbnRdID0gRXZlbnRSZWFkeVByb21pc2UoZXZlbnQpO1xuICAgICAgICByZXR1cm4gc3VwZXIub2ZmKGV2ZW50LCBsaXN0ZW5lcik7XG4gICAgfVxuICAgIC8vIFRvZG86IGRvY3VtZW50LCBlLmcuIGN1c3RvbSBmbG93LCBwbHVnaW5cbiAgICBhdXRob3JpemVVcmwoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBrY2UuYXV0aG9yaXplVXJsKCk7XG4gICAgfVxuICAgIGhhbmRsZU1vYmlsZUdyYW50KCkge1xuICAgICAgICBpZiAodGhpcy51cmxQYXJhbXMgJiYgdGhpcy5tb2JpbGVSZWRpcmVjdEZsb3cpIHtcbiAgICAgICAgICAgIC8vIGxvZyhcIlNlbmQgbWVzc2FnZSBldmVudFwiKTtcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2VFdmVudERhdGEgPSB7XG4gICAgICAgICAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkodGhpcy51cmxQYXJhbXMuZ2V0KFwiYXV0aG9yaXphdGlvbl9jb2RlXCIpIHx8XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXJsUGFyYW1zLmdldChcImFjY2Vzc190b2tlblwiKVxuICAgICAgICAgICAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZTogXCJ4dW1tX3NpZ25fcmVxdWVzdF9yZXNvbHZlZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxfcmVkaXJlY3RfdXJpOiBkb2N1bWVudC5sb2NhdGlvbi5ocmVmLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICA6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZTogXCJ4dW1tX3NpZ25fcmVxdWVzdF9yZWplY3RlZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiB0aGlzLnVybFBhcmFtcy5nZXQoXCJlcnJvclwiKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcl9jb2RlOiB0aGlzLnVybFBhcmFtcy5nZXQoXCJlcnJvcl9jb2RlXCIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yX2Rlc2NyaXB0aW9uOiB0aGlzLnVybFBhcmFtcy5nZXQoXCJlcnJvcl9kZXNjcmlwdGlvblwiKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIG9yaWdpbjogXCJodHRwczovL29hdXRoMi54dW1tLmFwcFwiLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0gbmV3IE1lc3NhZ2VFdmVudChcIm1lc3NhZ2VcIiwgbWVzc2FnZUV2ZW50RGF0YSk7XG4gICAgICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChldmVudCk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGF1dGhvcml6ZSgpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIC8vIERvIG5vdCBhdXRob3JpemUgdHdpY2VcbiAgICAgICAgICAgIGlmICh0aGlzLnJlc29sdmVkU3VjY2Vzc2Z1bGx5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucHJvbWlzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucmVzb2x2ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgeWllbGQgdGhpcy5waW5nO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAvLyBOb3BlIChwcmV2ZW50IDQwMSBlcnJvciBmcm9tIEFQSSB0byBibGVlZCBpbnRvIGF1dGggZmxvdylcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghdGhpcy5tb2JpbGVSZWRpcmVjdEZsb3cgJiYgIXRoaXMuYXV0b1Jlc29sdmVkRmxvdykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHVybCA9IHRoaXMuYXV0aG9yaXplVXJsKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgcG9wdXAgPSB3aW5kb3cub3Blbih1cmwsIFwiWHVtbVBrY2VMb2dpblwiLCBcImRpcmVjdG9yaWVzPW5vLHRpdGxlYmFyPW5vLHRvb2xiYXI9bm8sbG9jYXRpb249bm8sc3RhdHVzPW5vLFwiICtcbiAgICAgICAgICAgICAgICAgICAgXCJtZW51YmFyPW5vLHNjcm9sbGJhcnM9bm8scmVzaXphYmxlPW5vLHdpZHRoPTYwMCxoZWlnaHQ9NzkwXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMucG9wdXAgPSBwb3B1cDtcbiAgICAgICAgICAgICAgICBsb2coXCJQb3B1cCBvcGVuZWQuLi5cIiwgdXJsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucmVzb2x2ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIGNvbnN0IGNsZWFyVXJsUGFyYW1zID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdVcmxQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCgoX2EgPSBkb2N1bWVudCA9PT0gbnVsbCB8fCBkb2N1bWVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZG9jdW1lbnQubG9jYXRpb24pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zZWFyY2gpIHx8IFwiXCIpO1xuICAgICAgICAgICAgICAgIC8vIFBLQ0VcbiAgICAgICAgICAgICAgICBuZXdVcmxQYXJhbXMuZGVsZXRlKFwiYXV0aG9yaXphdGlvbl9jb2RlXCIpO1xuICAgICAgICAgICAgICAgIG5ld1VybFBhcmFtcy5kZWxldGUoXCJjb2RlXCIpO1xuICAgICAgICAgICAgICAgIG5ld1VybFBhcmFtcy5kZWxldGUoXCJzY29wZVwiKTtcbiAgICAgICAgICAgICAgICBuZXdVcmxQYXJhbXMuZGVsZXRlKFwic3RhdGVcIik7XG4gICAgICAgICAgICAgICAgLy8gSW1wbGljaXRcbiAgICAgICAgICAgICAgICBuZXdVcmxQYXJhbXMuZGVsZXRlKFwiYWNjZXNzX3Rva2VuXCIpO1xuICAgICAgICAgICAgICAgIG5ld1VybFBhcmFtcy5kZWxldGUoXCJyZWZyZXNoX3Rva2VuXCIpO1xuICAgICAgICAgICAgICAgIG5ld1VybFBhcmFtcy5kZWxldGUoXCJ0b2tlbl90eXBlXCIpO1xuICAgICAgICAgICAgICAgIG5ld1VybFBhcmFtcy5kZWxldGUoXCJleHBpcmVzX2luXCIpO1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld1NlYXJjaFBhcmFtc1N0cmluZyA9IG5ld1VybFBhcmFtcy50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHVybCA9IGRvY3VtZW50LmxvY2F0aW9uLmhyZWYuc3BsaXQoXCI/XCIpWzBdICtcbiAgICAgICAgICAgICAgICAgICAgKG5ld1NlYXJjaFBhcmFtc1N0cmluZyAhPT0gXCJcIiA/IFwiP1wiIDogXCJcIikgK1xuICAgICAgICAgICAgICAgICAgICBuZXdTZWFyY2hQYXJhbXNTdHJpbmc7XG4gICAgICAgICAgICAgICAgd2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlKHsgcGF0aDogdXJsIH0sIFwiXCIsIHVybCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY2xlYXJVcmxQYXJhbXMoKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmF1dG9SZXNvbHZlZEZsb3cpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMucmVzb2x2ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNvbHZlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvbWlzZSA9IFByb21pc2UucmVzb2x2ZSh0aGlzLmF1dG9SZXNvbHZlZEZsb3cpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlamVjdFByb21pc2UgPSB0aGlzLnJlc29sdmVQcm9taXNlID0gKCkgPT4geyB9O1xuICAgICAgICAgICAgICAgICAgICBsb2coXCJBdXRvIHJlc29sdmVkXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoXCJzdWNjZXNzXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMucHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNvbHZlUHJvbWlzZSA9IChfKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXNvbHZlZCA9IHJlc29sdmUoXyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc29sdmVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVzb2x2ZWRTdWNjZXNzZnVsbHkgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nKFwiWHVtbSBTaWduIGluIFJFU09MVkVEXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KFwic3VjY2Vzc1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNvbHZlZDtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWplY3RQcm9taXNlID0gKF8pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlamVjdGVkID0gcmVqZWN0KF8pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNvbHZlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoXCJlcnJvclwiLCB0eXBlb2YgXyA9PT0gXCJzdHJpbmdcIiA/IG5ldyBFcnJvcihfKSA6IF8pO1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nKFwiWHVtbSBTaWduIGluIFJFSkVDVEVEXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlamVjdGVkO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucHJvbWlzZTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHN0YXRlKCkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucHJvbWlzZTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGxvZ291dCgpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICAvLyBsb2coXCJQS0NFIExvZ291dFwiKTtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLmVtaXQoXCJsb2dnZWRvdXRcIiksIDApO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgdGhpcy5yZXNvbHZlZCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5yZXNvbHZlZFN1Y2Nlc3NmdWxseSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHRoaXMuYXV0b1Jlc29sdmVkRmxvdyA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIChfYSA9IHRoaXMub3B0aW9ucy5zdG9yYWdlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucmVtb3ZlSXRlbShcIlh1bW1Qa2NlSnd0XCIpO1xuICAgICAgICAgICAgdGhpcy5tb2JpbGVSZWRpcmVjdEZsb3cgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgLy8gTm90aGluZyB0byBkb1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZ2V0UG9wdXAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzID09PSBudWxsIHx8IHRoaXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRoaXMucG9wdXA7XG4gICAgfVxufVxuZXhwb3J0cy5YdW1tUGtjZVRocmVhZCA9IFh1bW1Qa2NlVGhyZWFkO1xuY29uc3QgdGhyZWFkID0gKF9YdW1tUGtjZSkgPT4ge1xuICAgIGxldCBhdHRhY2hlZCA9IGZhbHNlO1xuICAgIGlmIChfWHVtbVBrY2UpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgPT09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2Ygd2luZG93Ll9YdW1tUGtjZSA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5fWHVtbVBrY2UgPSBfWHVtbVBrY2U7XG4gICAgICAgICAgICAgICAgYXR0YWNoZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGluc3RhbmNlID0gd2luZG93ID09PSBudWxsIHx8IHdpbmRvdyA9PT0gdm9pZCAwID8gdm9pZCAwIDogd2luZG93Ll9YdW1tUGtjZTtcbiAgICBpZiAoaW5zdGFuY2UgJiYgYXR0YWNoZWQpIHtcbiAgICAgICAgbG9nKFwiWHVtbVBrY2UgYXR0YWNoZWQgdG8gd2luZG93XCIpO1xuICAgIH1cbiAgICByZXR1cm4gaW5zdGFuY2U7XG59O1xuY2xhc3MgWHVtbVBrY2Uge1xuICAgIGNvbnN0cnVjdG9yKHh1bW1BcGlLZXksIG9wdGlvbnNPclJlZGlyZWN0VXJsKSB7XG4gICAgICAgIGlmICh0eXBlb2Ygd2luZG93ID09PSBcInVuZGVmaW5lZFwiIHx8IHR5cGVvZiBkb2N1bWVudCA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhyZWFkKCkpIHtcbiAgICAgICAgICAgIHRocmVhZChuZXcgWHVtbVBrY2VUaHJlYWQoeHVtbUFwaUtleSwgb3B0aW9uc09yUmVkaXJlY3RVcmwpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBvbihldmVudCwgbGlzdGVuZXIpIHtcbiAgICAgICAgY29uc3QgdCA9IHRocmVhZCgpO1xuICAgICAgICBpZiAoIXQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0Lm9uKGV2ZW50LCBsaXN0ZW5lcik7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBvZmYoZXZlbnQsIGxpc3RlbmVyKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aHJlYWQoKTtcbiAgICAgICAgaWYgKCF0KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdC5vZmYoZXZlbnQsIGxpc3RlbmVyKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIGF1dGhvcml6ZSgpIHtcbiAgICAgICAgY29uc3QgdCA9IHRocmVhZCgpO1xuICAgICAgICBpZiAoIXQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdC5hdXRob3JpemUoKTtcbiAgICB9XG4gICAgc3RhdGUoKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aHJlYWQoKTtcbiAgICAgICAgaWYgKCF0KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHQuc3RhdGUoKTtcbiAgICB9XG4gICAgbG9nb3V0KCkge1xuICAgICAgICBjb25zdCB0ID0gdGhyZWFkKCk7XG4gICAgICAgIGlmICghdCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0LmxvZ291dCgpO1xuICAgIH1cbn1cbmV4cG9ydHMuWHVtbVBrY2UgPSBYdW1tUGtjZTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/xumm-oauth2-pkce/dist/index.js\n");

/***/ })

};
;